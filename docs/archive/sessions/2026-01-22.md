# READ FIRST - Current Project Status

**Date:** 2026-01-22 Late Evening (8:50 PM)  
**Status:** Venus NVIDIA NIM downloading model, Stella building vLLM, Mac needs restart

---

## üöÄ WHERE WE ARE NOW

### Venus (RTX PRO 6000 Max-Q Blackwell)
**Status:** üîÑ **NVIDIA NIM DOWNLOADING GPT-OSS 120B MODEL**

We switched to NVIDIA's official NIM (NVIDIA Inference Microservice) after encountering issues with standard vLLM. The NIM is currently downloading the model files at ~100 MiB/s.

**What happened tonight:**
1. ‚úÖ Fixed DNS issues permanently with `/etc/hosts` entries
2. ‚ùå vLLM v0.12.0 and v0.13.0 both hung at "Using Marlin backend" initialization
3. ‚úÖ Switched to NVIDIA NIM (official GPT-OSS container)
4. ‚ùå Initial download failed (needed NGC OTP authentication)
5. ‚úÖ OTP configured, download now in progress (~25GB/60-70GB downloaded)

```bash
# Check download progress after Mac restart
ssh venus-llm 'docker logs --tail=30 gpt-oss-120b'

# Check if container is still running
ssh venus-llm 'docker ps | grep gpt-oss'

# Check cache size (should be ~60-70GB when done)
ssh venus-llm 'du -sh ~/.cache/nim/'

# Once download completes, check for startup
ssh venus-llm 'docker logs -f gpt-oss-120b'
```

**Container Details:**
- Name: `gpt-oss-120b`
- Image: `nvcr.io/nim/openai/gpt-oss-120b:latest`
- Port: `8001` (host) ‚Üí `8000` (container)
- Model: OpenAI GPT-OSS 120B (117B params, MXFP4 quantized)
- API: OpenAI-compatible endpoints
- Cache: `~/.cache/nim/` (needs ~60-70GB)

**Expected startup process:**
1. Download model files (~60-70GB) - **IN PROGRESS NOW**
2. Load model into GPU memory (~68GB)
3. Initialize vLLM engine
4. Start OpenAI-compatible API server

### Stella (GB10 Grace Blackwell)
**Status:** üîÑ **BUILDING vLLM - 60% COMPLETE**

Custom vLLM Docker image with GB10 support is compiling 435 CUDA kernel files.

```bash
# Check build progress after Mac restart
ssh stella-llm './check-production-build.sh'

# Expected output:
# Status: BUILDING [261/435 files - 60.0%]
# Currently building flash attention kernels
```

**Build Details:**
- Progress: 261/435 files (60%)
- ETA: ~2 hours remaining
- Build type: Production wheel (not editable install)
- PyTorch: 2.11 nightly with CUDA 12.9
- Architecture: Hopper flash attention kernels for GB10

---

## ‚úÖ DNS FIX COMPLETED

**Problem:** macOS mDNS resolver wasn't resolving `.home.arpa` domains  
**Solution:** Added entries to `/etc/hosts` (permanent fix)

```bash
# Check DNS is working
ping -c 1 venus.home.arpa    # Should return 10.0.0.64
ping -c 1 stella.home.arpa   # Should return 10.0.0.81

# If DNS breaks again after restart, run:
cat /etc/hosts | grep -E "(venus|stella)"
# Should show:
# 10.0.0.64  venus.home.arpa venus
# 10.0.0.81  stella.home.arpa stella
```

**Note:** If your router assigns different IPs via DHCP, you'll need to update `/etc/hosts`. Recommend setting static DHCP reservations on your router.

---

## üîß WHAT TO CHECK AFTER MAC RESTART

### 1. Check Venus NIM Download Status

```bash
# Is container still running?
ssh venus-llm 'docker ps | grep gpt-oss'

# Check cache size (should be 60-70GB when complete)
ssh venus-llm 'du -sh ~/.cache/nim/'

# Check logs
ssh venus-llm 'docker logs --tail=50 gpt-oss-120b 2>&1'
```

**Possible states:**

‚úÖ **Download complete, service starting:**
```
INFO: Application startup complete
INFO: Uvicorn running on http://0.0.0.0:8000
```

üîÑ **Still downloading:**
```
INFO tokio.rs:811] Downloaded filename: model-00001-of-00015.safetensors
```

‚ùå **Download failed:**
```
ERROR: Download failed
ManifestDownloadError
```

### 2. Test Venus Service (once started)

```bash
# Health check
curl http://venus.home.arpa:8001/health

# List models
curl http://venus.home.arpa:8001/v1/models

# Test chat completion
curl http://venus.home.arpa:8001/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{
    "model": "openai/gpt-oss-120b",
    "messages": [{"role":"user", "content":"Write a Python function to calculate fibonacci"}],
    "max_tokens": 200
  }'
```

### 3. Check Stella Build Progress

```bash
ssh stella-llm './check-production-build.sh'
```

Expected: 60%+ complete, ETA ~2 hours

### 4. Monitor GPU Usage

```bash
# Venus - should show ~68GB when model loaded
ssh venus-llm 'nvidia-smi'

# Stella - probably won't show GPU usage during build
ssh stella-llm 'nvidia-smi'
```

---

## üêõ TROUBLESHOOTING COMMON ISSUES

### Venus NIM Failed to Start

```bash
# Check logs for errors
ssh venus-llm 'docker logs gpt-oss-120b 2>&1 | grep -i "error\|failed"'

# Check container status
ssh venus-llm 'docker ps -a | grep gpt-oss'

# If exited, check exit code and restart
ssh venus-llm 'docker start gpt-oss-120b && docker logs -f gpt-oss-120b'
```

### Download Failed / Incomplete

```bash
# Clear cache and restart (will re-download)
ssh venus-llm 'docker stop gpt-oss-120b && docker rm gpt-oss-120b'
ssh venus-llm 'rm -rf ~/.cache/nim/'
# Then manually restart container - see container details above
```

### DNS Not Working After Restart

```bash
# Check /etc/hosts
cat /etc/hosts | grep -E "(venus|stella)"

# If entries missing, add them:
echo "10.0.0.64  venus.home.arpa venus" | sudo tee -a /etc/hosts
echo "10.0.0.81  stella.home.arpa stella" | sudo tee -a /etc/hosts

# Flush DNS cache
sudo dscacheutil -flushcache
sudo killall -HUP mDNSResponder
```

### Stella Build Failed

```bash
# Check build status
ssh stella-llm './check-production-build.sh'

# If failed, check build log
ssh stella-llm 'tail -100 ~/vllm-gb10/production-build.log'

# May need to restart build (will take another ~4 hours)
```

---

## üìä CURRENT ARCHITECTURE

```
              Mac Studio (Frontend)
                       |
      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      |                                 |
Stella (Backend #1)            Venus (Backend #2)
Port: 8000                     Port: 8001
GB10 (128GB ARM)               RTX PRO 6000 Blackwell (98GB)
GLM-4.7-Flash (30B MoE)        GPT-OSS 120B (117B MoE)
Status: Building (60%)         Status: Downloading model
ETA: ~2 hours                  ETA: Should be done or close!
```

---

## üéØ NEXT STEPS (In Order)

### Immediate (After Mac Restart)

1. **Check Venus NIM Download**
   ```bash
   ssh venus-llm 'docker ps | grep gpt-oss && du -sh ~/.cache/nim/'
   ```
   - If download complete ‚Üí Wait for service to start (~5-10 min)
   - If still downloading ‚Üí Wait for completion
   - If failed ‚Üí Check troubleshooting section

2. **Test Venus Service** (once started)
   ```bash
   curl http://venus.home.arpa:8001/health
   ```

3. **Monitor Stella Build**
   ```bash
   ssh stella-llm './check-production-build.sh'
   ```

### Tomorrow Morning (After Stella Build Completes)

4. **Test Stella Build**
   ```bash
   ssh stella-llm 'docker images | grep vllm-gb10'
   # Should see: vllm-gb10:production
   ```

5. **Deploy Stella Service**
   ```bash
   ssh stella-llm
   cd ~/vllm-service
   # Update docker-compose.yml to use vllm-gb10:production
   docker-compose up -d
   ```

6. **Configure OpenCode with Both Backends**
   - Venus: `http://venus.home.arpa:8001/v1/` (GPT-OSS 120B)
   - Stella: `http://stella.home.arpa:8000/v1/` (GLM-4.7-Flash)

---

## üí° KEY LEARNINGS FROM TONIGHT

### What Worked
1. ‚úÖ **NVIDIA NIM** - Official container is better than generic vLLM for GPT-OSS
2. ‚úÖ **DNS fix with /etc/hosts** - Permanent solution for mDNS issues
3. ‚úÖ **NGC OTP authentication** - Required for downloading NIM models
4. ‚úÖ **Production wheel build** - Better than editable install for Stella

### What Didn't Work
1. ‚ùå **vLLM v0.12.0 & v0.13.0** - Both hung at "Using Marlin backend" initialization
2. ‚ùå **Direct vLLM with GPT-OSS** - Blackwell-specific Marlin backend issue
3. ‚ùå **Initial NIM download** - Required OTP that wasn't configured

### Technical Issues Encountered
- **Marlin MXFP4 backend hang**: vLLM's Marlin backend for MXFP4 quantization hangs during initialization on RTX PRO 6000 Blackwell
- **NGC authentication**: NVIDIA NIM requires valid NGC API key with OTP
- **Cache permissions**: NIM cache directory needs proper ownership
- **macOS DNS resolution**: `.home.arpa` domains don't resolve via mDNS

---

## üîê CREDENTIALS & KEYS

- **HuggingFace Token:** `~/gpt-oss-service/.env` (venus)
- **NGC API Key:** Stored in Docker config at `~/.docker/config.json` (venus)
- **SSH Keys:** `~/.ssh/id_ed25519_llm_agent`

---

## üìö DOCUMENTATION

- **VENUS_SETUP_SUMMARY.md** - Venus configuration (now outdated, switched to NIM)
- **VENUS_FIREWALL.md** - Firewall rules
- **SESSION_2026-01-21.md** - Yesterday's session (Stella setup)
- **vllm-gb10/** - Stella vLLM build project

---

## ‚è±Ô∏è TIMELINE & STATUS

**Started:** 2026-01-22 ~6:00 PM  
**DNS Fixed:** 2026-01-22 ~7:30 PM  
**NIM Download Started:** 2026-01-22 ~8:45 PM  
**Mac Restart Needed:** 2026-01-22 ~8:50 PM

**Venus NIM:** Downloading at 100 MiB/s (25GB/60-70GB at last check)  
**Stella Build:** 60% complete (261/435 files)

---

**Last Updated:** 2026-01-22 8:50 PM PST  
**Mac Status:** Needs restart  
**Venus Status:** NIM downloading model files  
**Stella Status:** Building (60% done)

**First commands after restart:**
```bash
# Check Venus download
ssh venus-llm 'docker ps && du -sh ~/.cache/nim/'

# Check Stella build
ssh stella-llm './check-production-build.sh'
```

**When Venus is ready:**
```bash
curl http://venus.home.arpa:8001/health
```

ü§û **Good luck! Both services should be up tomorrow morning!** üöÄ
